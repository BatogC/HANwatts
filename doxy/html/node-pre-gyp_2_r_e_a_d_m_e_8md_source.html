<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Raspberry Pi software: node-red-1881/node_modules/node-pre-gyp/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Raspberry Pi software
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">Scripts and libraries used by the Raspberry Pi</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('node-pre-gyp_2_r_e_a_d_m_e_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">node-red-1881/node_modules/node-pre-gyp/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="node-pre-gyp_2_r_e_a_d_m_e_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# node-pre-gyp</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;#### node-pre-gyp makes it easy to publish and install Node.js C++ addons from binaries</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;[![NPM](https://nodei.co/npm/node-pre-gyp.png?downloads=true&amp;downloadRank=true)](https://nodei.co/npm/node-pre-gyp/)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;[![Build Status](https://api.travis-ci.org/mapbox/node-pre-gyp.svg)](https://travis-ci.org/mapbox/node-pre-gyp)</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;[![Build status](https://ci.appveyor.com/api/projects/status/3nxewb425y83c0gv)](https://ci.appveyor.com/project/Mapbox/node-pre-gyp)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;[![Dependencies](https://david-dm.org/mapbox/node-pre-gyp.svg)](https://david-dm.org/mapbox/node-pre-gyp)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;`node-pre-gyp` stands between [npm](https://github.com/npm/npm) and [node-gyp](https://github.com/Tootallnate/node-gyp) and offers a cross-platform method of binary deployment.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;### Features</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; - A command line tool called `node-pre-gyp` that can install your package&#39;s C++ module from a binary.</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; - A variety of developer targeted commands for packaging, testing, and publishing binaries.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; - A JavaScript module that can dynamically require your installed binary: `require(&#39;node-pre-gyp&#39;).find`</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;For a hello world example of a module packaged with `node-pre-gyp` see &lt;https://github.com/springmeyer/node-addon-example&gt; and [the wiki ](https://github.com/mapbox/node-pre-gyp/wiki/Modules-using-node-pre-gyp) for real world examples.</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;## Credits</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; - The module is modeled after [node-gyp](https://github.com/Tootallnate/node-gyp) by [@Tootallnate](https://github.com/Tootallnate)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; - Motivation for initial development came from [@ErisDS](https://github.com/ErisDS) and the [Ghost Project](https://github.com/TryGhost/Ghost).</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; - Development is sponsored by [Mapbox](https://www.mapbox.com/)</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;## FAQ</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;See the [Frequently Ask Questions](https://github.com/mapbox/node-pre-gyp/wiki/FAQ).</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;## Depends</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; - Node.js &gt;= node v6.x</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;## Install</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;`node-pre-gyp` is designed to be installed as a local dependency of your Node.js C++ addon and accessed like:</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    ./node_modules/.bin/node-pre-gyp --help</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;But you can also install it globally:</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    npm install node-pre-gyp -g</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;## Usage</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;### Commands</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;View all possible commands:</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    node-pre-gyp --help</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;- clean - Remove the entire folder containing the compiled .node module</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;- install - Install pre-built binary for module</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;- reinstall - Run &quot;clean&quot; and &quot;install&quot; at once</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;- build - Compile the module by dispatching to node-gyp or nw-gyp</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;- rebuild - Run &quot;clean&quot; and &quot;build&quot; at once</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;- package - Pack binary into tarball</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;- testpackage - Test that the staged package is valid</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;- publish - Publish pre-built binary</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;- unpublish - Unpublish pre-built binary</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;- info - Fetch info on published binaries</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;You can also chain commands:</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    node-pre-gyp clean build unpublish publish info</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;### Options</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;Options include:</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; - `-C/--directory`: run the command in this directory</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; - `--build-from-source`: build from source instead of using pre-built binary</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; - `--update-binary`: reinstall by replacing previously installed local binary with remote binary</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; - `--runtime=node-webkit`: customize the runtime: `node`, `electron` and `node-webkit` are the valid options</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; - `--fallback-to-build`: fallback to building from source if pre-built binary is not available</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; - `--target=0.4.0`: Pass the target node or node-webkit version to compile against</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; - `--target_arch=ia32`: Pass the target arch and override the host `arch`. Valid values are &#39;ia32&#39;,&#39;x64&#39;, or `arm`.</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; - `--target_platform=win32`: Pass the target platform and override the host `platform`. Valid values are `linux`, `darwin`, `win32`, `sunos`, `freebsd`, `openbsd`, and `aix`.</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;Both `--build-from-source` and `--fallback-to-build` can be passed alone or they can provide values. You can pass `--fallback-to-build=false` to override the option as declared in package.json. In addition to being able to pass `--build-from-source` you can also pass `--build-from-source=myapp` where `myapp` is the name of your module.</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;For example: `npm install --build-from-source=myapp`. This is useful if:</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; - `myapp` is referenced in the package.json of a larger app and therefore `myapp` is being installed as a dependency with `npm install`.</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; - The larger app also depends on other modules installed with `node-pre-gyp`</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; - You only want to trigger a source compile for `myapp` and the other modules.</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;### Configuring</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;This is a guide to configuring your module to use node-pre-gyp.</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;#### 1) Add new entries to your `package.json`</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; - Add `node-pre-gyp` to `dependencies`</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; - Add `aws-sdk` as a `devDependency`</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; - Add a custom `install` script</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; - Declare a `binary` object</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;This looks like:</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;```js</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    &quot;dependencies&quot;  : {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      &quot;node-pre-gyp&quot;: &quot;0.6.x&quot;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    },</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    &quot;devDependencies&quot;: {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      &quot;aws-sdk&quot;: &quot;2.x&quot;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    &quot;scripts&quot;: {</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        &quot;install&quot;: &quot;node-pre-gyp install --fallback-to-build&quot;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    },</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    &quot;binary&quot;: {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        &quot;module_name&quot;: &quot;your_module&quot;,</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        &quot;module_path&quot;: &quot;./lib/binding/&quot;,</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        &quot;host&quot;: &quot;https://your_module.s3-us-west-1.amazonaws.com&quot;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    }</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;```</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;For a full example see [node-addon-examples&#39;s package.json](https://github.com/springmeyer/node-addon-example/blob/master/package.json).</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;Let&#39;s break this down:</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; - Dependencies need to list `node-pre-gyp`</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; - Your devDependencies should list `aws-sdk` so that you can run `node-pre-gyp publish` locally or a CI system. We recommend using `devDependencies` only since `aws-sdk` is large and not needed for `node-pre-gyp install` since it only uses http to fetch binaries</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; - Your `scripts` section should override the `install` target with `&quot;install&quot;: &quot;node-pre-gyp install --fallback-to-build&quot;`. This allows node-pre-gyp to be used instead of the default npm behavior of always source compiling with `node-gyp` directly.</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; - Your package.json should contain a `binary` section describing key properties you provide to allow node-pre-gyp to package optimally. They are detailed below.</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;Note: in the past we recommended putting `node-pre-gyp` in the `bundledDependencies`, but we no longer recommend this. In the past there were npm bugs (with node versions 0.10.x) that could lead to node-pre-gyp not being available at the right time during install (unless we bundled). This should no longer be the case. Also, for a time we recommended using `&quot;preinstall&quot;: &quot;npm install node-pre-gyp&quot;` as an alternative method to avoid needing to bundle. But this did not behave predictably across all npm versions - see https://github.com/mapbox/node-pre-gyp/issues/260 for the details. So we do not recommend using `preinstall` to install `node-pre-gyp`. More history on this at https://github.com/strongloop/fsevents/issues/157#issuecomment-265545908.</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;##### The `binary` object has three required properties</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;###### module_name</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;The name of your native node module. This value must:</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; - Match the name passed to [the NODE_MODULE macro](http://nodejs.org/api/addons.html#addons_hello_world)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; - Must be a valid C variable name (e.g. it cannot contain `-`)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; - Should not include the `.node` extension.</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;###### module_path</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;The location your native module is placed after a build. This should be an empty directory without other Javascript files. This entire directory will be packaged in the binary tarball. When installing from a remote package this directory will be overwritten with the contents of the tarball.</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;Note: This property supports variables based on [Versioning](#versioning).</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;###### host</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;A url to the remote location where you&#39;ve published tarball binaries (must be `https` not `http`).</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;It is highly recommended that you use Amazon S3. The reasons are:</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  - Various node-pre-gyp commands like `publish` and `info` only work with an S3 host.</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  - S3 is a very solid hosting platform for distributing large files.</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  - We provide detail documentation for using [S3 hosting](#s3-hosting) with node-pre-gyp.</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;Why then not require S3? Because while some applications using node-pre-gyp need to distribute binaries as large as 20-30 MB, others might have very small binaries and might wish to store them in a GitHub repo. This is not recommended, but if an author really wants to host in a non-S3 location then it should be possible.</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;It should also be mentioned that there is an optional and entirely separate npm module called [node-pre-gyp-github](https://github.com/bchr02/node-pre-gyp-github) which is intended to complement node-pre-gyp and be installed along with it. It provides the ability to store and publish your binaries within your repositories GitHub Releases if you would rather not use S3 directly. Installation and usage instructions can be found [here](https://github.com/bchr02/node-pre-gyp-github), but the basic premise is that instead of using the ```node-pre-gyp publish``` command you would use ```node-pre-gyp-github publish```.</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;##### The `binary` object has two optional properties</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;###### remote_path</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;It **is recommended** that you customize this property. This is an extra path to use for publishing and finding remote tarballs. The default value for `remote_path` is `&quot;&quot;` meaning that if you do not provide it then all packages will be published at the base of the `host`. It is recommended to provide a value like `./{name}/v{version}` to help organize remote packages in the case that you choose to publish multiple node addons to the same `host`.</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;Note: This property supports variables based on [Versioning](#versioning).</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;###### package_name</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;It is **not recommended** to override this property unless you are also overriding the `remote_path`. This is the versioned name of the remote tarball containing the binary `.node` module and any supporting files you&#39;ve placed inside the `module_path` directory. Unless you specify `package_name` in your `package.json` then it defaults to `{module_name}-v{version}-{node_abi}-{platform}-{arch}.tar.gz` which allows your binary to work across node versions, platforms, and architectures. If you are using `remote_path` that is also versioned by `./{module_name}/v{version}` then you could remove these variables from the `package_name` and just use: `{node_abi}-{platform}-{arch}.tar.gz`. Then your remote tarball will be looked up at, for example, `https://example.com/your-module/v0.1.0/node-v11-linux-x64.tar.gz`.</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;Avoiding the version of your module in the `package_name` and instead only embedding in a directory name can be useful when you want to make a quick tag of your module that does not change any C++ code. In this case you can just copy binaries to the new version behind the scenes like:</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;```sh</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;aws s3 sync --acl public-read s3://mapbox-node-binary/sqlite3/v3.0.3/ s3://mapbox-node-binary/sqlite3/v3.0.4/</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;```</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;Note: This property supports variables based on [Versioning](#versioning).</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;#### 2) Add a new target to binding.gyp</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;`node-pre-gyp` calls out to `node-gyp` to compile the module and passes variables along like [module_name](#module_name) and [module_path](#module_path).</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;A new target must be added to `binding.gyp` that moves the compiled `.node` module from `./build/Release/module_name.node` into the directory specified by `module_path`.</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;Add a target like this at the end of your `targets` list:</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;```js</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      &quot;target_name&quot;: &quot;action_after_build&quot;,</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      &quot;type&quot;: &quot;none&quot;,</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      &quot;dependencies&quot;: [ &quot;&lt;(module_name)&quot; ],</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      &quot;copies&quot;: [</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;          &quot;files&quot;: [ &quot;&lt;(PRODUCT_DIR)/&lt;(module_name).node&quot; ],</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;          &quot;destination&quot;: &quot;&lt;(module_path)&quot;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      ]</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;```</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;For a full example see [node-addon-example&#39;s binding.gyp](https://github.com/springmeyer/node-addon-example/blob/2ff60a8ded7f042864ad21db00c3a5a06cf47075/binding.gyp).</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;#### 3) Dynamically require your `.node`</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;Inside the main js file that requires your addon module you are likely currently doing:</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;```js</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;var binding = require(&#39;../build/Release/binding.node&#39;);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;```</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;or:</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;```js</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;var bindings = require(&#39;./bindings&#39;)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;```</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;Change those lines to:</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;```js</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;var binary = require(&#39;node-pre-gyp&#39;);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;var path = require(&#39;path&#39;);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;var binding_path = binary.find(path.resolve(path.join(__dirname,&#39;./package.json&#39;)));</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;var binding = require(binding_path);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;```</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;For a full example see [node-addon-example&#39;s index.js](https://github.com/springmeyer/node-addon-example/blob/2ff60a8ded7f042864ad21db00c3a5a06cf47075/index.js#L1-L4)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;#### 4) Build and package your app</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;Now build your module from source:</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    npm install --build-from-source</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;The `--build-from-source` tells `node-pre-gyp` to not look for a remote package and instead dispatch to node-gyp to build.</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;Now `node-pre-gyp` should now also be installed as a local dependency so the command line tool it offers can be found at `./node_modules/.bin/node-pre-gyp`.</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;#### 5) Test</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;Now `npm test` should work just as it did before.</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;#### 6) Publish the tarball</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;Then package your app:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    ./node_modules/.bin/node-pre-gyp package</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;Once packaged, now you can publish:</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    ./node_modules/.bin/node-pre-gyp publish</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;Currently the `publish` command pushes your binary to S3. This requires:</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; - You have installed `aws-sdk` with `npm install aws-sdk`</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; - You have created a bucket already.</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; - The `host` points to an S3 http or https endpoint.</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; - You have configured node-pre-gyp to read your S3 credentials (see [S3 hosting](#s3-hosting) for details).</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;You can also host your binaries elsewhere. To do this requires:</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; - You manually publish the binary created by the `package` command to an `https` endpoint</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; - Ensure that the `host` value points to your custom `https` endpoint.</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;#### 7) Automate builds</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;Now you need to publish builds for all the platforms and node versions you wish to support. This is best automated.</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; - See [Appveyor Automation](#appveyor-automation) for how to auto-publish builds on Windows.</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; - See [Travis Automation](#travis-automation) for how to auto-publish builds on OS X and Linux.</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;#### 8) You&#39;re done!</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;Now publish your module to the npm registry. Users will now be able to install your module from a binary.</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;What will happen is this:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;1. `npm install &lt;your package&gt;` will pull from the npm registry</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;2. npm will run the `install` script which will call out to `node-pre-gyp`</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;3. `node-pre-gyp` will fetch the binary `.node` module and unpack in the right place</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;4. Assuming that all worked, you are done</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;If a a binary was not available for a given platform and `--fallback-to-build` was used then `node-gyp rebuild` will be called to try to source compile the module.</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;## N-API Considerations</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;[N-API](https://nodejs.org/api/n-api.html#n_api_n_api) is an ABI-stable alternative to previous technologies such as [nan](https://github.com/nodejs/nan) which are tied to a specific Node runtime engine. N-API is Node runtime engine agnostic and guarantees modules created today will continue to run, without changes, into the future.</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;Using `node-pre-gyp` with N-API projects requires a handful of additional configuration values and imposes some additional requirements.</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;The most significant difference is that an N-API module can be coded to target multiple  N-API versions. Therefore, an N-API module must declare in its `package.json` file which N-API versions the module is designed to run against. In addition, since multiple builds may be required for a single module, path and file names must be specified in way that avoids naming conflicts.</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;### The `napi_versions` array property</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;An N-API modules must declare in its `package.json` file, the N-API versions the module is intended to support. This is accomplished by including an `napi-versions` array property in the `binary` object. For example:</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;```js</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;&quot;binary&quot;: {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    &quot;module_name&quot;: &quot;your_module&quot;,</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    &quot;module_path&quot;: &quot;your_module_path&quot;,</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    &quot;host&quot;: &quot;https://your_bucket.s3-us-west-1.amazonaws.com&quot;,</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    &quot;napi_versions&quot;: [1,3]</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;```</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;If the `napi_versions` array property is *not* present, `node-pre-gyp` operates as it always has. Including the `napi_versions` array property instructs `node-pre-gyp` that this is a N-API module build.</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;When the `napi_versions` array property is present, `node-pre-gyp` fires off multiple operations, one for each of the N-API versions in the array. In the example above, two operations are initiated, one for N-API version 1 and second for N-API version 3. How this version number is communicated is described next.</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;### The `napi_build_version` value</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;For each of the N-API module operations `node-pre-gyp` initiates, it ensures that the `napi_build_version` is set appropriately.</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;This value is of importance in two areas:</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;1. The C/C++ code which needs to know against which N-API version it should compile.</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;2. `node-pre-gyp` itself which must assign appropriate path and file names to avoid collisions.</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;### Defining `NAPI_VERSION` for the C/C++ code</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;The `napi_build_version` value is communicated to the C/C++ code by adding this code to the `binding.gyp` file:</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;```</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;&quot;defines&quot;: [</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    &quot;NAPI_VERSION=&lt;(napi_build_version)&quot;,</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;]</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;```</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;This ensures that `NAPI_VERSION`, an integer value, is declared appropriately to the C/C++ code for each build.</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;&gt; Note that earlier versions of this document recommended defining the symbol `NAPI_BUILD_VERSION`. `NAPI_VERSION` is prefered because it used by the N-API C/C++ headers to configure the specific N-API veriosn being requested. </div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;### Path and file naming requirements in `package.json`</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;Since `node-pre-gyp` fires off multiple operations for each request, it is essential that path and file names be created in such a way as to avoid collisions. This is accomplished by imposing additional path and file naming requirements.</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;Specifically, when performing N-API builds, the `{napi_build_version}` text configuration value  *must* be present in the `module_path` property. In addition, the `{napi_build_version}` text configuration value  *must* be present in either the `remote_path` or `package_name` property. (No problem if it&#39;s in both.)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;Here&#39;s an example:</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;```js</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;&quot;binary&quot;: {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    &quot;module_name&quot;: &quot;your_module&quot;,</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    &quot;module_path&quot;: &quot;./lib/binding/napi-v{napi_build_version}&quot;,</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    &quot;remote_path&quot;: &quot;./{module_name}/v{version}/{configuration}/&quot;,</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    &quot;package_name&quot;: &quot;{platform}-{arch}-napi-v{napi_build_version}.tar.gz&quot;,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    &quot;host&quot;: &quot;https://your_bucket.s3-us-west-1.amazonaws.com&quot;,</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    &quot;napi_versions&quot;: [1,3]</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;```</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;## Supporting both N-API and NAN builds</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;You may have a legacy native add-on that you wish to continue supporting for those versions of Node that do not support N-API, as you add N-API support for later Node versions. This can be accomplished by specifying the `node_napi_label` configuration value in the package.json `binary.package_name` property. </div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;Placing the configuration value `node_napi_label` in the package.json `binary.package_name` property instructs `node-pre-gyp` to build all viable N-API binaries supported by the current Node instance. If the current Node instance does not support N-API, `node-pre-gyp` will request a traditional, non-N-API build. </div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;The configuration value `node_napi_label` is set by `node-pre-gyp` to the type of build created, `napi` or `node`, and the version number. For N-API builds, the string contains the N-API version nad has values like `napi-v3`. For traditional, non-N-API builds, the string contains the ABI version with values like `node-v46`.</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;Here&#39;s how the `binary` configuration above might be changed to support both N-API and NAN builds:</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;```js</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;&quot;binary&quot;: {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    &quot;module_name&quot;: &quot;your_module&quot;,</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    &quot;module_path&quot;: &quot;./lib/binding/{node_napi_label}&quot;,</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    &quot;remote_path&quot;: &quot;./{module_name}/v{version}/{configuration}/&quot;,</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    &quot;package_name&quot;: &quot;{platform}-{arch}-{node_napi_label}.tar.gz&quot;,</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    &quot;host&quot;: &quot;https://your_bucket.s3-us-west-1.amazonaws.com&quot;,</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    &quot;napi_versions&quot;: [1,3]</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;```</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;The C/C++ symbol `NAPI_VERSION` can be used to distinguish N-API and non-N-API builds. The value of `NAPI_VERSION` is set to the integer N-API version for N-API builds and is set to `0` for non-N-API builds. </div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;For example:</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;```C</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;#if NAPI_VERSION</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;// N-API code goes here</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;#else</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;// NAN code goes here</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;#endif</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;```</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;### Two additional configuration values</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;The following two configuration values, which were implemented in previous versions of `node-pre-gyp`, continue to exist, but have been replaced by the `node_napi_label` configuration value described above.</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;1. `napi_version` If N-API is supported by the currently executing Node instance, this value is the N-API version number supported by Node. If N-API is not supported, this value is an empty string.</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;2. `node_abi_napi` If the value returned for `napi_version` is non empty, this value is `&#39;napi&#39;`. If the value returned for `napi_version` is empty, this value is the value returned for `node_abi`.</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;These values are present for use in the `binding.gyp` file and may be used as `{napi_version}` and `{node_abi_napi}` for text substituion in the `binary` properties of the `package.json` file.</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;## S3 Hosting</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;You can host wherever you choose but S3 is cheap, `node-pre-gyp publish` expects it, and S3 can be integrated well with [Travis.ci](http://travis-ci.org) to automate builds for OS X and Ubuntu, and with [Appveyor](http://appveyor.com) to automate builds for Windows. Here is an approach to do this:</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;First, get setup locally and test the workflow:</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;#### 1) Create an S3 bucket</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;And have your **key** and **secret key** ready for writing to the bucket.</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;It is recommended to create a IAM user with a policy that only gives permissions to the specific bucket you plan to publish to. This can be done in the [IAM console](https://console.aws.amazon.com/iam/) by: 1) adding a new user, 2) choosing `Attach User Policy`, 3) Using the `Policy Generator`, 4) selecting `Amazon S3` for the service, 5) adding the actions: `DeleteObject`, `GetObject`, `GetObjectAcl`, `ListBucket`, `PutObject`, `PutObjectAcl`, 6) adding an ARN of `arn:aws:s3:::bucket/*` (replacing `bucket` with your bucket name), and finally 7) clicking `Add Statement` and saving the policy. It should generate a policy like:</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;```js</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;{</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  &quot;Version&quot;: &quot;2012-10-17&quot;,</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  &quot;Statement&quot;: [</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      &quot;Sid&quot;: &quot;Stmt1394587197000&quot;,</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      &quot;Effect&quot;: &quot;Allow&quot;,</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      &quot;Action&quot;: [</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        &quot;s3:DeleteObject&quot;,</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        &quot;s3:GetObject&quot;,</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        &quot;s3:GetObjectAcl&quot;,</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        &quot;s3:ListBucket&quot;,</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        &quot;s3:PutObject&quot;,</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        &quot;s3:PutObjectAcl&quot;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      ],</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      &quot;Resource&quot;: [</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        &quot;arn:aws:s3:::node-pre-gyp-tests/*&quot;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      ]</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  ]</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;```</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;#### 2) Install node-pre-gyp</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;Either install it globally:</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    npm install node-pre-gyp -g</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;Or put the local version on your PATH</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    export PATH=`pwd`/node_modules/.bin/:$PATH</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;#### 3) Configure AWS credentials</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;There are several ways to do this.</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;You can use any of the methods described at http://docs.aws.amazon.com/AWSJavaScriptSDK/guide/node-configuring.html.</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;Or you can create a `~/.node_pre_gyprc`</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;Or pass options in any way supported by [RC](https://github.com/dominictarr/rc#standards)</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;A `~/.node_pre_gyprc` looks like:</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;```js</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;{</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    &quot;accessKeyId&quot;: &quot;xxx&quot;,</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    &quot;secretAccessKey&quot;: &quot;xxx&quot;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;```</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;Another way is to use your environment:</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    export node_pre_gyp_accessKeyId=xxx</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    export node_pre_gyp_secretAccessKey=xxx</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;You may also need to specify the `region` if it is not explicit in the `host` value you use. The `bucket` can also be specified but it is optional because `node-pre-gyp` will detect it from the `host` value.</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;#### 4) Package and publish your build</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;Install the `aws-sdk`:</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    npm install aws-sdk</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;Then publish:</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    node-pre-gyp package publish</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;Note: if you hit an error like `Hostname/IP doesn&#39;t match certificate&#39;s altnames` it may mean that you need to provide the `region` option in your config.</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;## Appveyor Automation</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;[Appveyor](http://www.appveyor.com/) can build binaries and publish the results per commit and supports:</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; - Windows Visual Studio 2013 and related compilers</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; - Both 64 bit (x64) and 32 bit (x86) build configurations</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; - Multiple Node.js versions</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;For an example of doing this see [node-sqlite3&#39;s appveyor.yml](https://github.com/mapbox/node-sqlite3/blob/master/appveyor.yml).</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;Below is a guide to getting set up:</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;#### 1) Create a free Appveyor account</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;Go to https://ci.appveyor.com/signup/free and sign in with your GitHub account.</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;#### 2) Create a new project</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;Go to https://ci.appveyor.com/projects/new and select the GitHub repo for your module</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;#### 3) Add appveyor.yml and push it</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;Once you have committed an `appveyor.yml` ([appveyor.yml reference](http://www.appveyor.com/docs/appveyor-yml)) to your GitHub repo and pushed it AppVeyor should automatically start building your project.</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;#### 4) Create secure variables</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;Encrypt your S3 AWS keys by going to &lt;https://ci.appveyor.com/tools/encrypt&gt; and hitting the `encrypt` button.</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;Then paste the result into your `appveyor.yml`</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;```yml</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;environment:</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  node_pre_gyp_accessKeyId:</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    secure: Dn9HKdLNYvDgPdQOzRq/DqZ/MPhjknRHB1o+/lVU8MA=</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  node_pre_gyp_secretAccessKey:</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    secure: W1rwNoSnOku1r+28gnoufO8UA8iWADmL1LiiwH9IOkIVhDTNGdGPJqAlLjNqwLnL</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;```</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;NOTE: keys are per account but not per repo (this is difference than Travis where keys are per repo but not related to the account used to encrypt them).</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;#### 5) Hook up publishing</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;Just put `node-pre-gyp package publish` in your `appveyor.yml` after `npm install`.</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;#### 6) Publish when you want</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;You might wish to publish binaries only on a specific commit. To do this you could borrow from the [Travis CI idea of commit keywords](http://about.travis-ci.org/docs/user/how-to-skip-a-build/) and add special handling for commit messages with `[publish binary]`:</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    SET CM=%APPVEYOR_REPO_COMMIT_MESSAGE%</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    if not &quot;%CM%&quot; == &quot;%CM:[publish binary]=%&quot; node-pre-gyp --msvs_version=2013 publish</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;If your commit message contains special characters (e.g. `&amp;`) this method might fail. An alternative is to use PowerShell, which gives you additional possibilities, like ignoring case by using `ToLower()`:</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    ps: if($env:APPVEYOR_REPO_COMMIT_MESSAGE.ToLower().Contains(&#39;[publish binary]&#39;)) { node-pre-gyp --msvs_version=2013 publish }</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;Remember this publishing is not the same as `npm publish`. We&#39;re just talking about the binary module here and not your entire npm package.</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;## Travis Automation</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;[Travis](https://travis-ci.org/) can push to S3 after a successful build and supports both:</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; - Ubuntu Precise and OS X (64 bit)</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; - Multiple Node.js versions</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;For an example of doing this see [node-add-example&#39;s .travis.yml](https://github.com/springmeyer/node-addon-example/blob/2ff60a8ded7f042864ad21db00c3a5a06cf47075/.travis.yml).</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;Note: if you need 32 bit binaries, this can be done from a 64 bit Travis machine. See [the node-sqlite3 scripts for an example of doing this](https://github.com/mapbox/node-sqlite3/blob/bae122aa6a2b8a45f6b717fab24e207740e32b5d/scripts/build_against_node.sh#L54-L74).</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;Below is a guide to getting set up:</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;#### 1) Install the Travis gem</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    gem install travis</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;#### 2) Create secure variables</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;Make sure you run this command from within the directory of your module.</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;Use `travis-encrypt` like:</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    travis encrypt node_pre_gyp_accessKeyId=${node_pre_gyp_accessKeyId}</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    travis encrypt node_pre_gyp_secretAccessKey=${node_pre_gyp_secretAccessKey}</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;Then put those values in your `.travis.yml` like:</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;```yaml</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;env:</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  global:</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    - secure: F+sEL/v56CzHqmCSSES4pEyC9NeQlkoR0Gs/ZuZxX1ytrj8SKtp3MKqBj7zhIclSdXBz4Ev966Da5ctmcTd410p0b240MV6BVOkLUtkjZJyErMBOkeb8n8yVfSoeMx8RiIhBmIvEn+rlQq+bSFis61/JkE9rxsjkGRZi14hHr4M=</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    - secure: o2nkUQIiABD139XS6L8pxq3XO5gch27hvm/gOdV+dzNKc/s2KomVPWcOyXNxtJGhtecAkABzaW8KHDDi5QL1kNEFx6BxFVMLO8rjFPsMVaBG9Ks6JiDQkkmrGNcnVdxI/6EKTLHTH5WLsz8+J7caDBzvKbEfTux5EamEhxIWgrI=</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;```</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;More details on Travis encryption at http://about.travis-ci.org/docs/user/encryption-keys/.</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;#### 3) Hook up publishing</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;Just put `node-pre-gyp package publish` in your `.travis.yml` after `npm install`.</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;##### OS X publishing</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;If you want binaries for OS X in addition to linux you can enable [multi-os for Travis](http://docs.travis-ci.com/user/multi-os/#Setting-.travis.yml)</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;Use a configuration like:</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;```yml</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;language: cpp</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;os:</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;- linux</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;- osx</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;env:</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  matrix:</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    - NODE_VERSION=&quot;4&quot;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    - NODE_VERSION=&quot;6&quot;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;before_install:</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;- rm -rf ~/.nvm/ &amp;&amp; git clone --depth 1 https://github.com/creationix/nvm.git ~/.nvm</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;- source ~/.nvm/nvm.sh</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;- nvm install $NODE_VERSION</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;- nvm use $NODE_VERSION</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;```</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;See [Travis OS X Gotchas](#travis-os-x-gotchas) for why we replace `language: node_js` and `node_js:` sections with `language: cpp` and a custom matrix.</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;Also create platform specific sections for any deps that need install. For example if you need libpng:</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;```yml</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;- if [ $(uname -s) == &#39;Linux&#39; ]; then apt-get install libpng-dev; fi;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;- if [ $(uname -s) == &#39;Darwin&#39; ]; then brew install libpng; fi;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;```</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;For detailed multi-OS examples see [node-mapnik](https://github.com/mapnik/node-mapnik/blob/master/.travis.yml) and [node-sqlite3](https://github.com/mapbox/node-sqlite3/blob/master/.travis.yml).</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;##### Travis OS X Gotchas</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;First, unlike the Travis Linux machines, the OS X machines do not put `node-pre-gyp` on PATH by default. To do so you will need to:</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;```sh</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;export PATH=$(pwd)/node_modules/.bin:${PATH}</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;```</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;Second, the OS X machines do not support using a matrix for installing different Node.js versions. So you need to bootstrap the installation of Node.js in a cross platform way.</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;By doing:</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;```yml</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;env:</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  matrix:</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    - NODE_VERSION=&quot;4&quot;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    - NODE_VERSION=&quot;6&quot;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;before_install:</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160; - rm -rf ~/.nvm/ &amp;&amp; git clone --depth 1 https://github.com/creationix/nvm.git ~/.nvm</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; - source ~/.nvm/nvm.sh</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; - nvm install $NODE_VERSION</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160; - nvm use $NODE_VERSION</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;```</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;You can easily recreate the previous behavior of this matrix:</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;```yml</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;node_js:</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  - &quot;4&quot;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  - &quot;6&quot;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;```</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;#### 4) Publish when you want</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;You might wish to publish binaries only on a specific commit. To do this you could borrow from the [Travis CI idea of commit keywords](http://about.travis-ci.org/docs/user/how-to-skip-a-build/) and add special handling for commit messages with `[publish binary]`:</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    COMMIT_MESSAGE=$(git log --format=%B --no-merges -n 1 | tr -d &#39;\n&#39;)</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    if [[ ${COMMIT_MESSAGE} =~ &quot;[publish binary]&quot; ]]; then node-pre-gyp publish; fi;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;Then you can trigger new binaries to be built like:</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    git commit -a -m &quot;[publish binary]&quot;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;Or, if you don&#39;t have any changes to make simply run:</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    git commit --allow-empty -m &quot;[publish binary]&quot;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;WARNING: if you are working in a pull request and publishing binaries from there then you will want to avoid double publishing when Travis CI builds both the `push` and `pr`. You only want to run the publish on the `push` commit. See https://github.com/Project-OSRM/node-osrm/blob/8eb837abe2e2e30e595093d16e5354bc5c573575/scripts/is_pr_merge.sh which is called from https://github.com/Project-OSRM/node-osrm/blob/8eb837abe2e2e30e595093d16e5354bc5c573575/scripts/publish.sh for an example of how to do this.</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;Remember this publishing is not the same as `npm publish`. We&#39;re just talking about the binary module here and not your entire npm package. To automate the publishing of your entire package to npm on Travis see http://about.travis-ci.org/docs/user/deployment/npm/</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;# Versioning</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;The `binary` properties of `module_path`, `remote_path`, and `package_name` support variable substitution. The strings are evaluated by `node-pre-gyp` depending on your system and any custom build flags you passed.</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; - `node_abi`: The node C++ `ABI` number. This value is available in Javascript as `process.versions.modules` as of [`&gt;= v0.10.4 &gt;= v0.11.7`](https://github.com/joyent/node/commit/ccabd4a6fa8a6eb79d29bc3bbe9fe2b6531c2d8e) and in C++ as the `NODE_MODULE_VERSION` define much earlier. For versions of Node before this was available we fallback to the V8 major and minor version.</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; - `platform` matches node&#39;s `process.platform` like `linux`, `darwin`, and `win32` unless the user passed the `--target_platform` option to override.</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; - `arch` matches node&#39;s `process.arch` like `x64` or `ia32` unless the user passes the `--target_arch` option to override.</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160; - `libc` matches `require(&#39;detect-libc&#39;).family` like `glibc` or `musl` unless the user passes the `--target_libc` option to override.</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; - `configuration` - Either &#39;Release&#39; or &#39;Debug&#39; depending on if `--debug` is passed during the build.</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; - `module_name` - the `binary.module_name` attribute from `package.json`.</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; - `version` - the semver `version` value for your module from `package.json` (NOTE: ignores the `semver.build` property).</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; - `major`, `minor`, `patch`, and `prelease` match the individual semver values for your module&#39;s `version`</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; - `build` - the sevmer `build` value. For example it would be `this.that` if your package.json `version` was `v1.0.0+this.that`</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; - `prerelease` - the semver `prerelease` value. For example it would be `alpha.beta` if your package.json `version` was `v1.0.0-alpha.beta`</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;The options are visible in the code at &lt;https://github.com/mapbox/node-pre-gyp/blob/612b7bca2604508d881e1187614870ba19a7f0c5/lib/util/versioning.js#L114-L127&gt;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;# Download binary files from a mirror</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;S3 is broken in China for the well known reason.</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;Using the `npm` config argument: `--{module_name}_binary_host_mirror` can download binary files through a mirror.</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;e.g.: Install [v8-profiler](https://www.npmjs.com/package/v8-profiler) from `npm`.</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;```bash</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;$ npm install v8-profiler --profiler_binary_host_mirror=https://npm.taobao.org/mirrors/node-inspector/</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;```</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="node-pre-gyp_2_r_e_a_d_m_e_8md.html">README.md</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
