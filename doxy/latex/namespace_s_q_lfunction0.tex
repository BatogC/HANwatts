\section{S\+Q\+Lfunction0 Namespace Reference}
\label{namespace_s_q_lfunction0}\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \textbf{ on\+\_\+connect} (\textbf{ client}, userdata, flags, rc)
\item 
def \textbf{ on\+\_\+disconnect} (\textbf{ client}, userdata, rc)
\item 
def \textbf{ update\+\_\+callback} (\textbf{ client}, userdata, message)
\item 
def \textbf{ new\+\_\+photon\+Measure\+\_\+callback} (\textbf{ client}, userdata, message)
\item 
def \textbf{ old\+\_\+photon\+Measure\+\_\+callback} (\textbf{ client}, userdata, message)
\item 
def \textbf{ send\+\_\+trung} ()
\item 
def \textbf{ send\+\_\+email} ()
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\textbf{ D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+ME} = int(4 $\ast$ 60 $\ast$ 60)
\item 
int \textbf{ email\+\_\+cntr} = 0
\item 
int \textbf{ S\+S\+Lport} = 465
\item 
string \textbf{ smtp\+\_\+server} = \char`\"{}smtp.\+gmail.\+com\char`\"{}
\item 
string \textbf{ sender\+\_\+email} = \char`\"{}tpi97364@gmail.\+com\char`\"{}
\item 
string \textbf{ receiver\+\_\+email} = \char`\"{}\char`\"{}
\item 
string \textbf{ sender\+\_\+password} = \char`\"{}controlsystem\char`\"{}
\item 
string \textbf{ email\+\_\+message}
\item 
\textbf{ email\+\_\+context} = ssl.\+create\+\_\+default\+\_\+context()
\item 
\textbf{ con} = None
\item 
string \textbf{ broker} = \char`\"{}broker.\+hivemq.\+com\char`\"{}
\item 
string \textbf{ path\+\_\+local} = \char`\"{}/media/D\+A\+T\+A\+B\+A\+SE/usertable.\+sqlite3\char`\"{}
\item 
string \textbf{ path} = \char`\"{}/mnt/dav/Data/usertable.\+sqlite3\char`\"{}
\item 
\textbf{ con\+\_\+local} = lite.\+connect(\textbf{ path\+\_\+local})
\item 
\textbf{ cur\+\_\+local} = con\+\_\+local.\+cursor()
\item 
\textbf{ cur} = con.\+cursor()
\item 
\textbf{ data\+Ref1} = cur.\+fetchone()
\item 
int \textbf{ err\+\_\+cnt} = 0
\item 
\textbf{ client} = mqtt.\+Client()
\item 
\textbf{ connected\+\_\+flag}
\item 
\textbf{ bad\+\_\+connection\+\_\+flag}
\item 
\textbf{ on\+\_\+connect}
\item 
\textbf{ on\+\_\+disconnect}
\item 
\textbf{ current\+\_\+time} = time.\+ctime(time.\+time())
\begin{DoxyCompactList}\small\item\em publish.\+single gives connection error if ran too early publish.\+single(\char`\"{}\+H\+A\+Nevse/testsql\char`\"{}, \char`\"{}\+Hello from S\+Q\+Lfunction\char`\"{}, hostname=broker) \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\label{namespace_s_q_lfunction0_ab9b9ddec7a9cc70e1b4f202c5ad24f1d}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!new\+\_\+photon\+Measure\+\_\+callback@{new\+\_\+photon\+Measure\+\_\+callback}}
\index{new\+\_\+photon\+Measure\+\_\+callback@{new\+\_\+photon\+Measure\+\_\+callback}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{new\+\_\+photon\+Measure\+\_\+callback()}
{\footnotesize\ttfamily def S\+Q\+Lfunction0.\+new\+\_\+photon\+Measure\+\_\+callback (\begin{DoxyParamCaption}\item[{}]{client,  }\item[{}]{userdata,  }\item[{}]{message }\end{DoxyParamCaption})}



Definition at line 165 of file S\+Q\+Lfunction0.\+py.


\begin{DoxyCode}
165 \textcolor{keyword}{def }new_photonMeasure_callback(client, userdata, message):
166     con = lite.connect(path)
167     cur = con.cursor()
168     data = json.loads(message.payload)    
169     print(data)
170     V1 = float(data.get(\textcolor{stringliteral}{"V1"}))
171     V2 = float(data.get(\textcolor{stringliteral}{"V2"}))
172     V3 = float(data.get(\textcolor{stringliteral}{"V3"}))
173     I1 = float(data.get(\textcolor{stringliteral}{"I1"}))
174     I2 = float(data.get(\textcolor{stringliteral}{"I2"}))
175     I3 = float(data.get(\textcolor{stringliteral}{"I3"}))
176     \textcolor{comment}{#P = float(data.get("P"))}
177     \textcolor{comment}{#E = float(data.get("E"))}
178     F = float(data.get(\textcolor{stringliteral}{"F"}))
179     Time = int(data.get(\textcolor{stringliteral}{"Time"}))
180     SocketID = int(data.get(\textcolor{stringliteral}{"SocketID"}))
181     UserID = str(data.get(\textcolor{stringliteral}{"UserID"}))
182     
183     cur.execute(\textcolor{stringliteral}{"SELECT name, rowid FROM users WHERE uidTag = ? "}, (UserID,) )
184     dataUser = cur.fetchone()
185     \textcolor{keywordflow}{try}:
186         dataUser[1]
187     \textcolor{keywordflow}{except}:
188         print(\textcolor{stringliteral}{"WARNING: Unauthorized user charging at socket "} + str(SocketID))
189         dataUser = (\textcolor{stringliteral}{'unknown'}, 31)                
190     
191     cur.execute(\textcolor{stringliteral}{"SELECT carId FROM car\_of\_user WHERE userId = ? "}, (dataUser[1],) )
192     carId = cur.fetchone()[0]        
193     
194     cur.execute(\textcolor{stringliteral}{"SELECT brand || ' ' || type FROM cars WHERE id = ? "}, (carId,) )
195     carName = cur.fetchone()[0]
196     
197     cur.execute(\textcolor{stringliteral}{"INSERT INTO measurements(userId, userName, carId, carName, socketId, V1, V2, V3, I1, I2,
       I3, F, Time) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?)"},
198                 (UserID, dataUser[0], carId, carName, SocketID, V1, V2, V3, I1, I2, I3, F, Time))
199     
200     
203     
204     \textcolor{comment}{# Or skip all .get() and do it in cur.execute     }
205     \textcolor{comment}{#cur.execute("INSERT INTO measurements(userId, socketId, V1, V2, V3, I1, I2, I3, P, E, F, Time)
       VALUES(?,?,?,?,?,?,?,?,?,?,?,?)",}
206     \textcolor{comment}{#            (str(data["UserID"]).upper(), int(data["SocketID"]), float(data["V1"]), float(data["V2"]),
       float(data["V3"]), float(data["I1"]), float(data["I2"]), float(data["I3"]), float(data["P"]),
       float(data["E"]), float(data["F"]), int(data["Time"]) ))}
207     
208    \textcolor{comment}{#for readable timestamp use this at end of INSERT: time.strftime('%Y-%m-%d %T',
       time.localtime(int(data["Time"]) ))}
209     
210     con.commit()
211 
212 
\end{DoxyCode}
\mbox{\label{namespace_s_q_lfunction0_ac2d0b2b3b62cb911116a5a9db8fb5675}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!old\+\_\+photon\+Measure\+\_\+callback@{old\+\_\+photon\+Measure\+\_\+callback}}
\index{old\+\_\+photon\+Measure\+\_\+callback@{old\+\_\+photon\+Measure\+\_\+callback}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{old\+\_\+photon\+Measure\+\_\+callback()}
{\footnotesize\ttfamily def S\+Q\+Lfunction0.\+old\+\_\+photon\+Measure\+\_\+callback (\begin{DoxyParamCaption}\item[{}]{client,  }\item[{}]{userdata,  }\item[{}]{message }\end{DoxyParamCaption})}



Definition at line 213 of file S\+Q\+Lfunction0.\+py.


\begin{DoxyCode}
213 \textcolor{keyword}{def }old_photonMeasure_callback(client, userdata, message):
214     con = lite.connect(path)
215     cur = con.cursor()
216     data = message.payload    
217     data = data.decode(\textcolor{stringliteral}{'UTF-8'})
218     print(data)
219     
220     index = []
221     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(data)):
222         \textcolor{keywordflow}{if} (data[i] == \textcolor{stringliteral}{'%'}):
223             index.append(i)
224     V1 = float(data[:index[0]])
225     V2 = float(data[index[0]+1:index[1]])
226     V3 = float(data[index[1]+1:index[2]])
227     I1 = float(data[index[2]+1:index[3]])
228     I2 = float(data[index[3]+1:index[4]])
229     I3 = float(data[index[4]+1:index[5]])
230     P = float(data[index[5]+1:index[6]])
231     E = float(data[index[6]+1:index[7]])
232     F = float(data[index[7]+1:index[8]])
233     Time = int(data[index[8]+1:index[9]])
234     SocketID = int(data[index[9]+1:index[10]])
235     UserID = data[index[10]+1:index[11]]
236     cur.execute(\textcolor{stringliteral}{"INSERT INTO photonMeasure(UIDtag, SocketID, V1, V2, V3, I1, I2, I3, P, E, F, Time)
       VALUES(?,?,?,?,?,?,?,?,?,?,?,?)"},
237                 (UserID, SocketID, V1, V2, V3, I1, I2, I3, P, E, F, Time))
238     con.commit()
239     \textcolor{comment}{#print(V1)}
240 
\end{DoxyCode}
\mbox{\label{namespace_s_q_lfunction0_af0df1f904d2b71f42c5b6e49c1b694fb}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!on\+\_\+connect@{on\+\_\+connect}}
\index{on\+\_\+connect@{on\+\_\+connect}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{on\+\_\+connect()}
{\footnotesize\ttfamily def S\+Q\+Lfunction0.\+on\+\_\+connect (\begin{DoxyParamCaption}\item[{}]{client,  }\item[{}]{userdata,  }\item[{}]{flags,  }\item[{}]{rc }\end{DoxyParamCaption})}



Definition at line 52 of file S\+Q\+Lfunction0.\+py.



References on\+\_\+connect.


\begin{DoxyCode}
52 \textcolor{keyword}{def }on_connect(client, userdata, flags, rc):
53     \textcolor{keywordflow}{if} rc == 0:
54         \textcolor{comment}{#print("Connection start")}
55         print(path)
56         client.bad\_connection\_flag = \textcolor{keyword}{False}
57         client.connected\_flag = \textcolor{keyword}{True}        
58         err\_cnt = 0
59 
60         client.publish(\textcolor{stringliteral}{"HANevse/testsql"}, \textcolor{stringliteral}{"Hello from SQLfunction"},1 ,\textcolor{keyword}{False})
61 \textcolor{comment}{#        client.subscribe([("HANevse/getUsers", 2), ("HANevse/UpdateUser", 2), ("HANevse/photonMeasure",
       2)])}
62         client.subscribe([(\textcolor{stringliteral}{"HANevse/updateUser"}, 2), (\textcolor{stringliteral}{"HANevse/photonMeasure"}, 2)])
63         print(\textcolor{stringliteral}{"Connected OK"})
64     \textcolor{keywordflow}{else}:
65         print(\textcolor{stringliteral}{"Bad connection, RC = "}, rc)
66         client.bad\_connection\_flag = \textcolor{keyword}{True}
67         
\end{DoxyCode}
\mbox{\label{namespace_s_q_lfunction0_a67dfbec5d5db9aa54fe47d462a5b356e}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!on\+\_\+disconnect@{on\+\_\+disconnect}}
\index{on\+\_\+disconnect@{on\+\_\+disconnect}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{on\+\_\+disconnect()}
{\footnotesize\ttfamily def S\+Q\+Lfunction0.\+on\+\_\+disconnect (\begin{DoxyParamCaption}\item[{}]{client,  }\item[{}]{userdata,  }\item[{}]{rc }\end{DoxyParamCaption})}



Definition at line 68 of file S\+Q\+Lfunction0.\+py.



References on\+\_\+disconnect.


\begin{DoxyCode}
68 \textcolor{keyword}{def }on_disconnect(client, userdata, rc):
69     client.connected\_flag = \textcolor{keyword}{False}
70     \textcolor{keywordflow}{if} rc != 0:
71         print(\textcolor{stringliteral}{"Unexpected disconnection."})
72         client.bad\_connection\_flag = \textcolor{keyword}{True}
73     \textcolor{keywordflow}{else}:
74         print(\textcolor{stringliteral}{"Normal disconnection."})
75 
76 \textcolor{comment}{# def SendUser\_callback(client, userdata, message):}
77 \textcolor{comment}{#     #print(message.payload)}
78 \textcolor{comment}{#     con = lite.connect(path)}
79 \textcolor{comment}{#     cur = con.cursor()}
80 \textcolor{comment}{#     cur.execute('select * from list')}
81 \textcolor{comment}{# }
82 \textcolor{comment}{#     data = cur.fetchall()}
83 \textcolor{comment}{#     dataSend = ""}
84 \textcolor{comment}{# }
85 \textcolor{comment}{#     for element in data:}
86 \textcolor{comment}{#         print(element)}
87 \textcolor{comment}{#         dataSend +=
       (str(element[0])+'%'+element[1]+'%'+element[2]+'%'+str(element[3])+'%'+element[4]+'%'+str(element[5])+'%'+element[6]+'%'+str(element[7])+'%'+str(element[8])+'%')}
88 \textcolor{comment}{#     }
89 \textcolor{comment}{#     client.publish("HANevse/UserList", dataSend, 2, True)}
90 \textcolor{comment}{#     #publish.single("HANevse/UserList", dataSend, hostname=broker)}
91 \textcolor{comment}{#     #print(dataSend)}
92 
\end{DoxyCode}
\mbox{\label{namespace_s_q_lfunction0_a15fafbd51d5b5450a61dbe5b8476f34e}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!send\+\_\+email@{send\+\_\+email}}
\index{send\+\_\+email@{send\+\_\+email}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{send\+\_\+email()}
{\footnotesize\ttfamily def S\+Q\+Lfunction0.\+send\+\_\+email (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 258 of file S\+Q\+Lfunction0.\+py.


\begin{DoxyCode}
258 \textcolor{keyword}{def }send_email():
259     con = lite.connect(path)
260     cur = con.cursor()
261     cur.execute(\textcolor{stringliteral}{"SELECT email, rowid FROM users WHERE LastStartOrStop <= ? AND email <> '' AND mailed < 1
       AND socketId IS NOT NULL"}, ((str(int(time.time()) - DISCONNECT\_TIME)),) )
262     dataRef = cur.fetchall()
263     \textcolor{keywordflow}{if} dataRef \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
264         \textcolor{keywordflow}{return}
265     with smtplib.SMTP\_SSL(smtp\_server, SSLport, context=email\_context) \textcolor{keyword}{as} server:
266         server.login(sender\_email, sender\_password)
267         \textcolor{keywordflow}{for} element \textcolor{keywordflow}{in} dataRef:            
268             server.sendmail(sender\_email, element[0], email\_message)
269             cur.execute(\textcolor{stringliteral}{"UPDATE users SET mailed = 1 WHERE rowid=?"}, (element[1],))
270             
271     \textcolor{comment}{#cur.execute("UPDATE users SET mailed = 0 WHERE LastStartOrStop > ? AND mailed > 0 AND socketId IS
       NULL", ((str(int(time.time()) - DISCONNECT\_TIME)),) ) }
272     cur.execute(\textcolor{stringliteral}{"UPDATE users SET mailed = 0 WHERE mailed > 0 AND socketId IS NULL"}) 
273     con.commit()
274     
275 
276 \textcolor{comment}{#setup mqtt}
\end{DoxyCode}
\mbox{\label{namespace_s_q_lfunction0_ab417fd6714305987eaee04fc959f0f17}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!send\+\_\+trung@{send\+\_\+trung}}
\index{send\+\_\+trung@{send\+\_\+trung}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{send\+\_\+trung()}
{\footnotesize\ttfamily def S\+Q\+Lfunction0.\+send\+\_\+trung (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 241 of file S\+Q\+Lfunction0.\+py.


\begin{DoxyCode}
241 \textcolor{keyword}{def }send_trung():
242     con = lite.connect(path)
243     cur = con.cursor()
244     cur.execute(\textcolor{stringliteral}{"SELECT rowid FROM measurements WHERE Time <= ? AND Time >= ? LIMIT 1"}, ((str(int(time.time
      ()) - DISCONNECT\_TIME)),(str(int(time.time()) - DISCONNECT\_TIME - 29)),) )
245     dataRef = cur.fetchone()
246     \textcolor{keywordflow}{if} dataRef \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
247         print(\textcolor{stringliteral}{" \(\backslash\)b"})
248     \textcolor{keywordflow}{else}:
249         cur.execute(\textcolor{stringliteral}{"SELECT rowid FROM measurements WHERE Time >= ? LIMIT 1"}, ((str(int(time.time()) - 60))
      ,) )
250         dataRef = cur.fetchone()
251         \textcolor{keywordflow}{if} dataRef \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}:
252             print(\textcolor{stringliteral}{" \(\backslash\)b"})
253         \textcolor{keywordflow}{else}:
254             with smtplib.SMTP\_SSL(smtp\_server, SSLport, context=email\_context) \textcolor{keyword}{as} server:
255                 server.login(sender\_email, sender\_password)                    
256                 server.sendmail(sender\_email, \textcolor{stringliteral}{"nguyenxuan.trung@han.nl"}, email\_message)
257 
\end{DoxyCode}
\mbox{\label{namespace_s_q_lfunction0_a4874edbbc1d9bf43987045a6b1132ace}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!update\+\_\+callback@{update\+\_\+callback}}
\index{update\+\_\+callback@{update\+\_\+callback}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{update\+\_\+callback()}
{\footnotesize\ttfamily def S\+Q\+Lfunction0.\+update\+\_\+callback (\begin{DoxyParamCaption}\item[{}]{client,  }\item[{}]{userdata,  }\item[{}]{message }\end{DoxyParamCaption})}



Definition at line 93 of file S\+Q\+Lfunction0.\+py.


\begin{DoxyCode}
93 \textcolor{keyword}{def }update_callback(client, userdata, message):
94     con = lite.connect(path)
95     cur = con.cursor()
96     data = json.loads(message.payload)
97     print(data)
98     
99     UserId = str(data.get(\textcolor{stringliteral}{"UserId"})).upper()
100     socketId = int(data.get(\textcolor{stringliteral}{"Charger"}))
101     StartTime = int(data.get(\textcolor{stringliteral}{"StartTime"}))
102     \textcolor{comment}{#print(UserId)}
103     
104     cur.execute(\textcolor{stringliteral}{"SELECT LastStartOrStop, socketId, verified FROM users WHERE uidTag=? LIMIT 1"}, (UserId,))
105     dataUser = cur.fetchone() \textcolor{comment}{# returns a tuple}
106     dataSend = str(socketId) + \textcolor{stringliteral}{";"}
107     
108     cur.execute(\textcolor{stringliteral}{"SELECT socketId FROM users WHERE socketId=? LIMIT 1"}, (socketId,))
109     socketUsed = cur.fetchone()
110     \textcolor{comment}{#The socketUsed can be either None or the socket number, so parsing it can give error without check}
111     \textcolor{keywordflow}{if} socketUsed \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}:
112         socketUsed = socketUsed[0]
113         
114     \textcolor{comment}{#This is the filter for checking and preparing the answer to the EV charger}
115     \textcolor{keywordflow}{if} dataUser \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None}: \textcolor{comment}{# if user ID is in list}
116         \textcolor{keywordflow}{if} (dataUser[2] == \textcolor{stringliteral}{"true"}):
117             \textcolor{keywordflow}{if} ((StartTime - dataUser[0]) >= 20): \textcolor{comment}{# if last swipe is over 20s ago}
118                 \textcolor{keywordflow}{if} (socketUsed == socketId): \textcolor{comment}{#if this socket is used now}
119                     \textcolor{keywordflow}{if} (socketId == dataUser[1]): \textcolor{comment}{# if user already uses this socket}
120                         dataSend += \textcolor{stringliteral}{"4"} \textcolor{comment}{# successfully stop charging}
121                         cur.execute(\textcolor{stringliteral}{"UPDATE users SET socketId=?, LastStartOrStop=? WHERE uidTag=?"}, (\textcolor{keywordtype}{None},
       StartTime, UserId))
122                     \textcolor{keywordflow}{else}:
123                         dataSend += \textcolor{stringliteral}{"3"} \textcolor{comment}{# socket is occupied by another user }
124                 \textcolor{keywordflow}{else}: \textcolor{comment}{#if this socket is free}
125                     \textcolor{keywordflow}{if} dataUser[1] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}: \textcolor{comment}{#if user was not using any socket}
126                         dataSend += \textcolor{stringliteral}{"1"} \textcolor{comment}{# successfully start new charge}
127                         cur.execute(\textcolor{stringliteral}{"UPDATE users SET socketId=?, LastStartOrStop=? WHERE uidTag=?"}, (
      socketId, StartTime, UserId))
128                     \textcolor{keywordflow}{else}:
129                         dataSend += \textcolor{stringliteral}{"6"} \textcolor{comment}{# user already at another socket}
130             \textcolor{keywordflow}{else}: \textcolor{comment}{#if swiped less than 20s ago}
131                 \textcolor{keywordflow}{if} (socketUsed == socketId): \textcolor{comment}{#if this socket is used now}
132                     \textcolor{keywordflow}{if} (socketId == dataUser[1]): \textcolor{comment}{# if user already uses this socket}
133                         dataSend += \textcolor{stringliteral}{"5"} \textcolor{comment}{# you just started using this socket less than 20s ago}
134                     \textcolor{keywordflow}{else}:
135                         dataSend += \textcolor{stringliteral}{"3"} \textcolor{comment}{# socket is occupied by another user}
136                 \textcolor{keywordflow}{else}: \textcolor{comment}{#if this socket is free}
137                     \textcolor{keywordflow}{if} dataUser[1] \textcolor{keywordflow}{is} \textcolor{keywordtype}{None}: \textcolor{comment}{#if user was not using any socket}
138                         dataSend += \textcolor{stringliteral}{"2"} \textcolor{comment}{#charger is free, but you already swiped less than 20s ago}
139                     \textcolor{keywordflow}{else}:
140                         dataSend += \textcolor{stringliteral}{"6"}  \textcolor{comment}{# user already at another socket}
141         \textcolor{keywordflow}{else}:
142              dataSend += \textcolor{stringliteral}{"7"} \textcolor{comment}{#user not verified by admin           }
143     \textcolor{keywordflow}{else}:
144         dataSend += \textcolor{stringliteral}{"8"} \textcolor{comment}{#user not in the userlist}
145     
146     con.commit()
147     
148     client.publish(\textcolor{stringliteral}{"HANevse/allowUser"}, dataSend, 0, \textcolor{keyword}{False})
149 
150 \textcolor{comment}{# def Update\_callback(client, userdata, message):}
151 \textcolor{comment}{#     con = lite.connect(path)}
152 \textcolor{comment}{#     cur = con.cursor()}
153 \textcolor{comment}{#     data = message.payload}
154 \textcolor{comment}{#     index = []}
155 \textcolor{comment}{#     for i in range(len(data)):}
156 \textcolor{comment}{#         if (data[i] == '%'):}
157 \textcolor{comment}{#             index.append(i)}
158 \textcolor{comment}{#     UserId = int(data[:index[0]])}
159 \textcolor{comment}{#     PendingCharger = int(data[index[0]+1:index[1]])}
160 \textcolor{comment}{#     StartTime = int(data[index[1]+1:index[2]])}
161 \textcolor{comment}{#     cur.execute("UPDATE list SET PendingCharger=? WHERE Id=?", (PendingCharger, UserId))}
162 \textcolor{comment}{#     cur.execute("UPDATE list SET StartTime=? WHERE Id=?", (StartTime, UserId))}
163 \textcolor{comment}{#     con.commmit()}
164 
\end{DoxyCode}


\subsection{Variable Documentation}
\mbox{\label{namespace_s_q_lfunction0_a6e2c4206231876a833b69eaf9323e5c6}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!bad\+\_\+connection\+\_\+flag@{bad\+\_\+connection\+\_\+flag}}
\index{bad\+\_\+connection\+\_\+flag@{bad\+\_\+connection\+\_\+flag}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{bad\+\_\+connection\+\_\+flag}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+bad\+\_\+connection\+\_\+flag}



Definition at line 280 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a40e2d6336afe43a41a07d18e078428ee}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!broker@{broker}}
\index{broker@{broker}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{broker}
{\footnotesize\ttfamily string S\+Q\+Lfunction0.\+broker = \char`\"{}broker.\+hivemq.\+com\char`\"{}}



Definition at line 28 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a04ddbc8f7afec51c817d4f6247fc2ac4}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!client@{client}}
\index{client@{client}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{client}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+client = mqtt.\+Client()}



Definition at line 277 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a14332a941a7353253f1de3cfd50c2cc3}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!con@{con}}
\index{con@{con}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{con}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+con = None}



Definition at line 27 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a138caa3c8169863d65c5d77272619c95}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!con\+\_\+local@{con\+\_\+local}}
\index{con\+\_\+local@{con\+\_\+local}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{con\+\_\+local}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+con\+\_\+local = lite.\+connect(\textbf{ path\+\_\+local})}



Definition at line 36 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a2563e47416089d82120dd800e6c75140}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!connected\+\_\+flag@{connected\+\_\+flag}}
\index{connected\+\_\+flag@{connected\+\_\+flag}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{connected\+\_\+flag}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+connected\+\_\+flag}



Definition at line 279 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_afb4f2538bb92f4f1c2a89d6ec1479431}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!cur@{cur}}
\index{cur@{cur}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{cur}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+cur = con.\+cursor()}



Definition at line 45 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a262b8e2310d06be84bb653d1348b0993}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!cur\+\_\+local@{cur\+\_\+local}}
\index{cur\+\_\+local@{cur\+\_\+local}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{cur\+\_\+local}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+cur\+\_\+local = con\+\_\+local.\+cursor()}



Definition at line 37 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a2d781d1428b26d7f4672104b29e77f61}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!current\+\_\+time@{current\+\_\+time}}
\index{current\+\_\+time@{current\+\_\+time}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{current\+\_\+time}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+current\+\_\+time = time.\+ctime(time.\+time())}



publish.\+single gives connection error if ran too early publish.\+single(\char`\"{}\+H\+A\+Nevse/testsql\char`\"{}, \char`\"{}\+Hello from S\+Q\+Lfunction\char`\"{}, hostname=broker) 



Definition at line 305 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a079742e0b1a952fc11e3f5c1ff11f088}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!data\+Ref1@{data\+Ref1}}
\index{data\+Ref1@{data\+Ref1}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{data\+Ref1}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+data\+Ref1 = cur.\+fetchone()}



Definition at line 47 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a152076215c881c27bf09a5883ff02445}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+ME@{D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+ME}}
\index{D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+ME@{D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+ME}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+ME}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+T\+I\+ME = int(4 $\ast$ 60 $\ast$ 60)}



Definition at line 10 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a6758517dd4942832561ab80a5d3b2e8a}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!email\+\_\+cntr@{email\+\_\+cntr}}
\index{email\+\_\+cntr@{email\+\_\+cntr}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{email\+\_\+cntr}
{\footnotesize\ttfamily int S\+Q\+Lfunction0.\+email\+\_\+cntr = 0}



Definition at line 12 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a41e0256ae441a632af4c9a9dc14d33eb}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!email\+\_\+context@{email\+\_\+context}}
\index{email\+\_\+context@{email\+\_\+context}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{email\+\_\+context}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+email\+\_\+context = ssl.\+create\+\_\+default\+\_\+context()}



Definition at line 25 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_aaf1a5b185d0c43f93d0640465c0ade22}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!email\+\_\+message@{email\+\_\+message}}
\index{email\+\_\+message@{email\+\_\+message}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{email\+\_\+message}
{\footnotesize\ttfamily string S\+Q\+Lfunction0.\+email\+\_\+message}

{\bfseries Initial value\+:}
\begin{DoxyCode}
1 =  \textcolor{stringliteral}{"""\(\backslash\)}
2 \textcolor{stringliteral}{Subject: Unplug car}
3 \textcolor{stringliteral}{}
4 \textcolor{stringliteral}{Please unplug your car from the EV charger. Over 4 hours have passed since it was plugged in.}
5 \textcolor{stringliteral}{}
6 \textcolor{stringliteral}{This is an automatically generated email. A response to this email will not be read."""}
\end{DoxyCode}


Definition at line 18 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a9f5d5bbdf9858d57e66b899886e2908e}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!err\+\_\+cnt@{err\+\_\+cnt}}
\index{err\+\_\+cnt@{err\+\_\+cnt}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{err\+\_\+cnt}
{\footnotesize\ttfamily int S\+Q\+Lfunction0.\+err\+\_\+cnt = 0}



Definition at line 50 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a8d6be78e5f5a86099dde5f92c140edcc}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!on\+\_\+connect@{on\+\_\+connect}}
\index{on\+\_\+connect@{on\+\_\+connect}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{on\+\_\+connect}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+on\+\_\+connect}



Definition at line 281 of file S\+Q\+Lfunction0.\+py.



Referenced by on\+\_\+connect().

\mbox{\label{namespace_s_q_lfunction0_ab6876d03f6bdc93f66d2326e650c7a68}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!on\+\_\+disconnect@{on\+\_\+disconnect}}
\index{on\+\_\+disconnect@{on\+\_\+disconnect}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{on\+\_\+disconnect}
{\footnotesize\ttfamily S\+Q\+Lfunction0.\+on\+\_\+disconnect}



Definition at line 282 of file S\+Q\+Lfunction0.\+py.



Referenced by on\+\_\+disconnect().

\mbox{\label{namespace_s_q_lfunction0_af8774bed7222c5e0acc2e01e627ef43b}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!path@{path}}
\index{path@{path}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{path}
{\footnotesize\ttfamily string S\+Q\+Lfunction0.\+path = \char`\"{}/mnt/dav/Data/usertable.\+sqlite3\char`\"{}}



Definition at line 34 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a3f5d6140bb4e035c4fecdc454748d6ff}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!path\+\_\+local@{path\+\_\+local}}
\index{path\+\_\+local@{path\+\_\+local}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{path\+\_\+local}
{\footnotesize\ttfamily string S\+Q\+Lfunction0.\+path\+\_\+local = \char`\"{}/media/D\+A\+T\+A\+B\+A\+SE/usertable.\+sqlite3\char`\"{}}



Definition at line 33 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a02578384bdde34e6aaadd0765e20032b}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!receiver\+\_\+email@{receiver\+\_\+email}}
\index{receiver\+\_\+email@{receiver\+\_\+email}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{receiver\+\_\+email}
{\footnotesize\ttfamily string S\+Q\+Lfunction0.\+receiver\+\_\+email = \char`\"{}\char`\"{}}



Definition at line 16 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_ab8feea4f96d3fac4208e9eb36584803d}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!sender\+\_\+email@{sender\+\_\+email}}
\index{sender\+\_\+email@{sender\+\_\+email}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{sender\+\_\+email}
{\footnotesize\ttfamily string S\+Q\+Lfunction0.\+sender\+\_\+email = \char`\"{}tpi97364@gmail.\+com\char`\"{}}



Definition at line 15 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_aa1116be30f93f9a4a67b49ad586b477e}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!sender\+\_\+password@{sender\+\_\+password}}
\index{sender\+\_\+password@{sender\+\_\+password}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{sender\+\_\+password}
{\footnotesize\ttfamily string S\+Q\+Lfunction0.\+sender\+\_\+password = \char`\"{}controlsystem\char`\"{}}



Definition at line 17 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_ab3dced66a9775c45598296b3e0f20384}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!smtp\+\_\+server@{smtp\+\_\+server}}
\index{smtp\+\_\+server@{smtp\+\_\+server}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{smtp\+\_\+server}
{\footnotesize\ttfamily string S\+Q\+Lfunction0.\+smtp\+\_\+server = \char`\"{}smtp.\+gmail.\+com\char`\"{}}



Definition at line 14 of file S\+Q\+Lfunction0.\+py.

\mbox{\label{namespace_s_q_lfunction0_a4f79b287bc6d361c461836921fb01ee8}} 
\index{S\+Q\+Lfunction0@{S\+Q\+Lfunction0}!S\+S\+Lport@{S\+S\+Lport}}
\index{S\+S\+Lport@{S\+S\+Lport}!S\+Q\+Lfunction0@{S\+Q\+Lfunction0}}
\subsubsection{S\+S\+Lport}
{\footnotesize\ttfamily int S\+Q\+Lfunction0.\+S\+S\+Lport = 465}



Definition at line 13 of file S\+Q\+Lfunction0.\+py.

